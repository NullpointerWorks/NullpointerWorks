<!DOCTYPE html>
<html lang="en-US">
	<head>
		<title>ARGB Controller V2 | Nullpointer Works</title>
		<meta charset="utf-8"/>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="Nullpointer Works Portfolio ARGB Controller" />
		<meta name="keywords" content="argb,controller,null*,nullpointer,works,nullpointerworks" />
		<meta name="author" content="Michiel Drost" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="css/argb-control-v2.css" type="text/css" />
		<link rel="stylesheet" href="lib/vs2015.css" />
	</head>
	<body>
		<div class="parallax"></div>
		<div class="content">
			<div class="title">ARGB Controller v2</div>
			
			<!-- index -->
			<div class="chapter">
				<a id="table" href="#table"><img style="width: 20px;" /></a>Table of Content
			</div>
			<div class="toc">
				<div><a href="#intro">Introduction</a></div>
				<div><a href="#design">Design</a></div>
				<div><a href="#schema">Schematic</a></div>
				<div><a href="#layout">PCB Layout</a></div>
				<div><a href="#assembly">Assembly</a></div>
				<div><a href="#enclosure">Enclosure</a></div>
				<div><a href="#code">Code</a></div>
				<div><a href="#downloads">Downloads</a></div>
			</div>
			
			<!-- introduction -->
			<div class="chapter">
				<a id="intro" href="#intro"><img style="width: 20px;" src="img/star.svg" /></a>Introduction
			</div>
			<p>For the majority of people that own a computer treat it as nothing more than a fancy box. A tool that 
			breaks often and is always a hassle to update or kept up to speed. They use it to check their 
			e-mails, view and print documents, update their socials and perhaps play a game of solitair. However, in 
			the eyes of an enthusiast it's not just a fancy box, nor an over-powered calculator. It's a piece of 
			furnature that requires the same love and care like anything else in the household.</p>
			<p>In particular the gaming community is expressing this love in a way similar to the people tuning their 
			car's performance and looks. When you search online for water-cooled PCs you find images of hardline tube 
			cooling systems with colorful coolant and lots of lighting and cable wiring matching in color to fit the 
			theme.</p>
			<p>Mind you I'm not a hardcore PC tuner, but I do enjoy tinkering when I have the oppertunity. One of 
			those opportunities had risen when I was building my new PC. The new case has plenty of room for future 
			upgrades and eight fan mounting points. Since I had some multicolor fans laying around, I thought it be 
			fun to have those installed. Unfortunately, the original controller for those fans was lacking so I opted 
			to make my own.</p>
			
			<img onclick="openURL('img/argb_fan_800.jpg');" style="cursor: zoom-in;" class="image_pane" src="img/argb_fan_800.jpg"></img>
			<div class="image_desc">A 120mm multicolor computer fan from Sharkoon. (not affiliated)</div>
			
			<!-- reviewing my options -->
			<div class="chapter">
				<a id="design" href="#design"><img style="width: 20px;" src="img/star.svg" /></a>Design
			</div>
			<p>Reviewing my options I stumbled on a library available for the Arduino named "FastLED" that allows for 
			controlling addressable LEDs. Good stuff, since the LEDs inside the multicolor fans are addressable red, 
			green and blue(RGB) LEDs. I'm not sure exactly which product series they used, but I suspect they are 
			WS2812B. The WS2812 are a popular choice in RGB strips and are consealed in a reasonably sized package. 
			Having checked, it turns out the fan's enclosure has a LED strip glued inside to form a circle.</p>
			<p>The Arduino development platform primarely utilize AVR microcontrollers and among the most popular, the 
			Mega328, has attained a large code base. Arduino has made development for these microcontrollers very easy 
			with their programming software and has made the AVR family quite popular. </p>
			<p>The FastLED library can allocate a single pin for sending data to an addressable LED. All other LEDs 
			on the strip have their data input daisy-chained together on the output of the previous. Only the first 
			LED in the chain needs to be informed on what behaviour the others are to display. So to control eight 
			RGB fans I need 8 digital pins, one for each LED strip. The Mega328 has 10 digital I/O pins and 5 analog 
			pins that can be configured to be inputs, or digital outputs. To signal the controller to step to the next 
			color pattern I need to ensure I keep at least one interrupt-capable pin as an input.</p>
			<p>To really complete the project I need an enclosure to protect the circuitry. Since 2.5 inch drive 
			mounting points are very common nowadays it would be nice if the controller can be mounted in an open slot. 
			But that's completely optional. I own a Creality Ender-3 3D-printer so I can print the enclosure right 
			here at my workspace.</p>
			
			<!-- drawing the schematic -->
			<div class="chapter">
				<a id="schema" href="#schema"><img style="width: 20px;" src="img/star.svg" /></a>Schematics
			</div>
			<p>In the schematic below I've drawn an AMP connector to supply the controller with power. The vast majority of 
			power supplies will have such a connector available. The reverse polarity protection is optional, but 
			I've added it in for good measure. You could opt for a SATA power connector instead if you feel like 
			leaving AMP in a museum. </p>
			<img onclick="openURL('img/schem/Supply.png');" style="cursor: zoom-in;" class="image_pane" src="img/schem/Supply.png"></img>
			<div class="image_desc">ATX Power supply to the controller.</div>
			
			<p>Next up is the USB connection. I want to be able to upload code to the device with as much ease as 
			possible. This is accomplished using an FT232 integrated circuit (IC). It translates the USB communication 
			protocol to UART which the microcontroller understands. I've added two LEDs to indicate when 
			communication is happening. These are available on pin 22 and 23 by default on a fresh FT232 IC. The 
			USB lines have SP1003 transient suppression diodes to help protect against electrostatic discharge events. 
			This could be, for example, someone touching the bare circuit board while not properly grounded or a power 
			spike from the power supply unit. The RX, TX and DTR(Data Terminal Ready) signal lines will go to the 
			microcontroller.</p>
			<img onclick="openURL('img/schem/UART.png');" style="cursor: zoom-in;" class="image_pane" src="img/schem/UART.png"></img>
			<div class="image_desc">USB input to UART conversion.</div>
			
			<p>Hooking up the microcontroller is pretty straight forward. The RX, TX and DTR will go to pin 1, 2 and 3 
			of the Mega328. Remember to swap the RX and TX lines between the two IC's. When someone is transmitting(TX) 
			the other is recieving(RX), and visa versa. Pin 12 through 19 will serve as data lines for the ARGB strips. 
			Pin 4 is an interrupt-capable pin which I'll hook up to a switch. You could hook up the switch directly, but
			I really recommend using a debouncing circuit.</p>
			<img onclick="openURL('img/schem/MCU.png');" style="cursor: zoom-in;" class="image_pane" src="img/schem/MCU.png"></img>
			<div class="image_desc">Microcontroller circuitry with switch debouncing.</div>
			
			<p>The data lines from the Mega328 will each branch off to a 3-pin header. Two of those pins are for power 
			and ground bypassed with a capacitor to reduce some noise.</p>
			<img onclick="openURL('img/schem/LEDStrips.png');" style="cursor: zoom-in;" class="image_pane" src="img/schem/LEDStrips.png"></img>
			<div class="image_desc">Addressable-RGB strip headers.</div>
			
			<p>Lastly, the fans get their 12 volts directly from the PC's power supply unit. We're not going to track or 
			modify the fan's speed. The fans are an inductive load so I added flyback diodes to protect against voltage 
			spikes. </p>
			<img onclick="openURL('img/schem/FanConnection.png');" style="cursor: zoom-in;" class="image_pane" src="img/schem/FanConnection.png"></img>
			<div class="image_desc">12V ventilation headers.</div>
			
			<!-- drawing the PCB -->
			<div class="chapter">
				<a id="layout" href="#layout"><img style="width: 20px;" src="img/star.svg" /></a>PCB Layout
			</div>
			
			<p>The only through-hole(TH) components on the PCB are headers and the Mega328, everything else are surface-mounted 
			devices(SMD). I decided on TH instead of SMD for the microcontroller to make maintenance easier. This 
			version does not have an in-system programming(ISP) interface so you can't burn a bootloader into the 
			microcontroller directly. I may add this in future revisions. The location of the Mega328 will be populated 
			by a 28-pin insertion socket. </p>
			<img onclick="openURL('img/pcb/top.png');" style="cursor: zoom-in;" class="image_pane" src="img/pcb/top.png"></img>
			<div class="image_desc">PCB top layer.</div>
			
			<p>To isolate the 12V and 5V section I made sure the fans and ARGB header have their own copper planes on the 
			PCB. The the common powerlines seperate as well, so it's the responsibility of the power supply unit to manage 
			the power output. The four large non-plated drill holes are the mounting holes that should match the dimensions 
			of a 2.5-inch drive. </p>
			
			<p>The bottom layer is simple enough. There are no components placed and is just for soldering the TH components.</p>
			<img onclick="openURL('img/pcb/bot.png');" style="cursor: zoom-in;" class="image_pane" src="img/pcb/bot.png"></img>
			<div class="image_desc">PCB bottom layer.</div>
			
			<p>I'll not be etching the PCB myself but outsource it to <a href="https://aisler.net" target="_blank">Aisler</a> 
			instead. They have a factory situated in Germany which is convenient for me living in the Netherlands. Note 
			that I'm not affiliated to Aisler.</p>
			
			<!-- board assembly -->
			<div class="chapter">
				<a id="assembly" href="#assembly"><img style="width: 20px;" src="img/star.svg" /></a>Assembly
			</div>
			<p></p>
			
			
			
			
			<!-- drawing the enclosure for 3d printing -->
			<div class="chapter">
				<a id="enclosure" href="#enclosure"><img style="width: 20px;" src="img/star.svg" /></a>Enclosure
			</div>
			<p></p>
			
			<!-- writing the controller code -->
			<div class="chapter">
				<a id="code" href="#code"><img style="width: 20px;" src="img/star.svg" /></a>Code
			</div>
			<p></p>
			
			<div class="codeblock">
				<pre><code class="cpp"></code></pre>
			</div>
			
			
			
			
			
			<!-- various downloads -->
			<div class="chapter">
				<a id="downloads" href="#downloads"><img style="width: 20px;" src="img/star.svg" /></a>Downloads
			</div>
			
			<div></div>
			<p></p>
		</div>
		<!-- credits -->
		<div class="credits">
			
		</div>
		<!-- footer -->
		<div class="footer">
			<div class="copynotice">NullpointerWorks &copy; 2021</div>
		</div>
	</body>
	<script src="js/argb-control-v2.js" type="text/javascript"></script>
	<script src="lib/highlight.pack.js"></script>
	<script type="text/javascript">
		function openURL(image)
		{
			window.open(image, "_blank");
		}
		
		hljs.initHighlightingOnLoad();
	</script>
</html>
